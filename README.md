# Reimu Bot

Reimu Bot is a Discord bot inspired by Reimu Hakurei, the shrine maiden from the *Touhou Project* series. It provides interactive features such as fortune-telling (omikuji), donation tracking, and message logging, with a SQLite database for persistent storage. The bot is designed to engage users with themed commands and responses while maintaining a robust backend for data management.

## Features

- **Fortune-Telling (Omikuji)**: Users can draw fortune slips with detailed predictions for love, career, health, and more.
- **Donation System**: Users can donate virtual "offerings" to the shrine, with cooldowns and balance tracking.
- **Message Logging**: Stores user messages in a SQLite database, with automatic cleanup of old entries.
- **Admin Commands**: Includes shutdown and restart commands restricted to the bot owner.
- **Customizable Responses**: Integrates with an AI API for dynamic, context-aware replies.

## Prerequisites

- Python 3.8 or higher
- Discord account and bot token
- Required Python libraries (listed in `requirements.txt`)
- API key for ChatAnywhere (or another compatible API service)
- SQLite (included with Python)

## Installation

1. **Clone the Repository**:
   ```bash
   git clone https://github.com/Shiroko253/Reimubot.git
   cd Reimubot
   ```
2. **Install Dependencies:**
   Create a virtual environment (optional) and install the required libraries:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```
   Required libraries include:
   - **`py-cord`**
   - **`python-dotenv`**
   - **`openai == 0.28`**
   - **`pyyaml`**
   - Others as specified in **~~requirements.txt~~**
3. **Set Up Environment Variables:**
   Create a **`.env`** file in the project root and add the following:
   ```bash
   REIMU_TOKEN=your_discord_bot_token
   AUTHOR_ID=your_discord_user_id
   CHATANYWHERE_API3=your_api_key
   ```
4. **Initialize the Database:**
   Run the bot or the database script (**`db_3.py`**) to create the SQLite database (**`example3.db`**).

5. **Run the Bot:**
  Start the bot with:
  ```bash
  python Reimu.py
  ```
## Usage

Invite the bot to your Discord server using the bot’s invite link (generated via Discord Developer Portal). Once the bot is online, interact with it using the following commands:

### Commands
- **/draw_lots**: Draw a fortune slip with predictions for love, career, health, suggested actions, and a lucky item. Cooldown: 5 hours.
- **/donate <amount>**: Donate virtual offerings to the shrine. Reduces the fortune-drawing cooldown if the amount exceeds 1000. Cooldown: 1 hour.
- **/shutdown**: Shut down the bot (owner-only).
- **/restart**: Restart the bot (owner-only).

### Message Interaction
- Reply to the bot’s messages or mention it to trigger a response generated by the AI API.
- Messages are logged in the database for context-aware replies, with non-permanent entries cleaned up every 30 minutes.

## File Structure

- **`Reimu.py`**:
  - The main bot file, handling Discord interactions, command processing, and API integration.
  - Manages message logging, database cleanup, and cooldowns for commands.
  - Integrates with `omikuji.py` for fortune-telling and `db_3.py` for database operations.

- **`omikuji.py`**:
  - A module for the `/draw_lots` command, providing fortune-telling functionality.
  - Defines a list of fortunes with details for love, career, health, suggested actions, and lucky items.
  - Returns formatted fortune text and a color code for Discord embeds.

- **`db_3.py`**:
  - A database management script for interacting with the SQLite database (`example3.db`).
  - Supports adding, viewing, and deleting background information entries, including bulk operations.
  - Used for testing and manual database modifications outside the bot’s runtime.

## Database

The bot uses a SQLite database (`example3.db`) with the following tables:

- **UserMessages**:
  - Stores user messages with fields for `id`, `user_id`, `message`, `repeat_count`, `is_permanent`, and `created_at`.
  - Non-permanent messages are deleted after 30 minutes unless repeated 10+ times.

- **BackgroundInfo**:
  - Stores user background information with fields for `id`, `user_id`, and `info`.
  - Used to provide context for AI-generated responses.

## Configuration

- **Cooldowns**:
  - Fortune-drawing: 5 hours (reducible by donating >1000 offerings).
  - Donations: 1 hour.
- **Donation Penalties**:
  - Repeated attempts to draw lots during cooldown may deduct 5000 offerings after the third attempt.
- **Database Cleanup**:
  - Non-permanent messages are removed every 30 minutes.

## Contributing

Contributions are welcome! To contribute:
1. Fork the repository.
2. Create a feature branch (`git checkout -b feature/your-feature`).
3. Commit your changes (`git commit -m "Add your feature"`).
4. Push to the branch (`git push origin feature/your-feature`).
5. Open a pull request.

Please ensure your code follows the project’s style and includes appropriate tests.

## Troubleshooting

- **Bot Not Responding**:
  - Verify the Discord token and API key in `.env`.
  - Check the console for error messages or review `main-error.log`.
- **Database Errors**:
  - Ensure `example3.db` is writable and not corrupted.
  - Run `db_3.py` to test database connectivity.
- **Command Cooldowns**:
  - Cooldowns are stored in `Reimu_lots.json`. Delete or modify entries if testing requires bypassing them.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.

## Acknowledgments

- Inspired by *Touhou Project* and Reimu Hakurei’s character.
- Built with `py-cord` and SQLite for robust bot functionality.
- Thanks to the open-source community for providing essential libraries and tools.
